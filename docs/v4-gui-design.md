# CapScope V1 GUI 设计文档

> Batch 4 产出物 — UI 结构与交互流程

---

## 1. 主界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  CapScope - 美股市值查看工具                              [─][□][×] │
├─────────────────────────────────────────────────────────────────┤
│  📅 日期: [2024-01-15 ▼]  [🔄 刷新]  [💾 导出CSV]              │
│  🔍 搜索: [________________]                                    │
├─────────────────────────────────────────────────────────────────┤
│  [全部] [信息技术] [医疗保健] [金融] [消费] [工业] [能源] ...    │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ # │ Ticker │ 公司名称          │ 行业     │ 收盘价 │ 市值(B) │    │
│  ├───┼────────┼──────────────────┼─────────┼────────┼─────────┤    │
│  │ 1 │ AAPL   │ Apple Inc.       │ 信息技术 │ 185.92│ 2,875.0 │    │
│  │ 2 │ MSFT   │ Microsoft Corp.  │ 信息技术 │ 402.56│ 2,991.0 │    │
│  │ 3 │ GOOGL  │ Alphabet Inc.    │ 通信服务 │ 141.80│ 1,782.5 │    │
│  │...│ ...    │ ...              │ ...     │ ...   │ ...     │    │
│  └─────────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────┤
│  数据日期: 2024-01-15 (Mon) │ 共 548 只 │ 加载耗时: 1m 32s        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 组件说明

### 2.1 顶部工具栏

| 组件 | 类型 | 功能 |
|------|------|------|
| 日期选择器 | QDateEdit | 选择查询日期 |
| 刷新按钮 | QPushButton | 重新加载数据 |
| 导出按钮 | QPushButton | 导出当前视图为 CSV |
| 搜索框 | QLineEdit | 按 ticker 或公司名过滤 |

### 2.2 行业 Tab 栏

| 组件 | 类型 | 功能 |
|------|------|------|
| Tab Bar | QTabWidget | 切换行业视图 |
| "全部" Tab | - | 显示全市场 Top 100 |
| 各行业 Tab | - | 显示该行业 Top 100 |

### 2.3 数据表格

| 列 | 宽度 | 对齐 | 说明 |
|----|------|------|------|
| # | 50 | 居中 | 排名 |
| Ticker | 80 | 左 | 股票代码 |
| 公司名称 | 200 | 左 | shortName |
| 行业 | 100 | 左 | 中文行业名 |
| 收盘价 | 80 | 右 | USD |
| 市值(B) | 100 | 右 | 十亿美元 |

### 2.4 状态栏

- 实际数据日期
- 股票总数
- 加载耗时

---

## 3. 交互流程

### 3.1 启动流程

```
┌──────────────┐
│   启动程序    │
└──────┬───────┘
       ↓
┌──────────────┐
│ 显示空白界面  │
│ 日期=今天    │
└──────┬───────┘
       ↓
┌──────────────┐
│ 用户点击刷新  │  ← 首次需手动触发
└──────┬───────┘
       ↓
┌──────────────┐
│ 显示加载对话框│
│ "正在加载..."│
└──────┬───────┘
       ↓
┌──────────────┐
│ 后台线程加载  │
│ 元数据+价格  │
└──────┬───────┘
       ↓
┌──────────────┐
│ 更新表格显示  │
│ 更新状态栏   │
└──────────────┘
```

### 3.2 切换日期

```
用户选择新日期 → 点击刷新 → 重新加载价格 → 更新表格
```

### 3.3 搜索过滤

```
用户输入搜索词 → 实时过滤当前表格 → 只显示匹配项
(搜索 ticker 或公司名，不区分大小写)
```

### 3.4 切换行业 Tab

```
用户点击行业 Tab → 表格显示该行业 Top 100 → 搜索框保持
```

### 3.5 导出 CSV

```
用户点击导出 → 弹出保存对话框 → 导出当前视图（含过滤）
```

---

## 4. 错误处理

| 场景 | 处理 |
|------|------|
| 网络错误 | 弹窗提示 "网络连接失败，请检查网络" |
| 无数据返回 | 弹窗提示 "未获取到数据" |
| 加载超时 | 弹窗提示 "加载超时，请重试" |

**原则:** 
- 不自动重试
- 明确提示错误原因
- 用户手动点击重试

---

## 5. 性能考虑

| 场景 | 策略 |
|------|------|
| 加载中 | 显示进度对话框，禁用刷新按钮 |
| 大量数据 | QTableView + QAbstractTableModel（虚拟化） |
| 搜索 | 本地过滤，不重新请求 |

---

*文档版本: v1.0 | 创建日期: 2026-01-30*
